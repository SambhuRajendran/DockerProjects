pipeline {
    agent any
    environment {
        IMAGE_NAME = 'rsambhu/nodeapp' // Replace with your image name
        REGISTRY = 'registry.hub.docker.com' // Replace with your Docker registry
        REGISTRY_CREDENTIALS_ID = 'eac6699b-b1bf-484f-97f2-68e9c861ba80' // Replace with your credentials ID
    }
    stages {
        stage('Checkout Source Code') {
            steps {
                git branch: 'main', url: 'https://github.com/SambhuRajendran/DockerProjects.git'
            }
        }
        stage('Build Docker Image') {
            steps {
                script {
                    sh "docker build -t ${IMAGE_NAME}:${env.BUILD_NUMBER} ."
                }
            }
        }
        stage('Push Docker Image') {
            steps {
                script {
                    // Log in to Docker registry
                    docker.withRegistry("https://${REGISTRY}", REGISTRY_CREDENTIALS_ID) {
                        // Push the image to the Docker registry
                        docker.image("${IMAGE_NAME}:${env.BUILD_NUMBER}").push()
                    }
                }
            }
        }
        stage('Run Docker Container') {
            steps {
                script {
                    // Run the Docker container
                    sh "docker run -d -p 2001:3000 ${IMAGE_NAME}:${env.BUILD_NUMBER}"
                }
            }
        }
    }
}
